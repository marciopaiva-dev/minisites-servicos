<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de MiniSite</title>
  <meta name="description" content="Gere automaticamente um MiniSite com WhatsApp e, se habilitado, uma proposta em DOCX." />
  <style>
    :root{
      --bg:#0d1b2a; --panel:#121c2a; --panel-2:#1b263b; --muted:#8fb3d6; --text:#ffffff;
      --cta:#ffc300; --cta-hover:#e6ac00; --border:#2a3b55; --ok:#22c55e; --err:#ef4444; --focus:#3b82f6;
    }
    *{box-sizing:border-box}
    body{margin:0; padding:32px 16px; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    .container{max-width:720px;margin:0 auto}
    h1{color:#facc15;margin:0 0 10px}
    p.lead{color:#9fb4ca;margin:0 0 16px}
    label{display:block;margin:12px 0 6px;font-weight:700}
    input,textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:#0f1f33;color:#fff;font-size:16px;outline:none}
    input:focus,textarea:focus{border-color:var(--focus); box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    button{width:100%;margin-top:14px;padding:12px;border:0;border-radius:10px;background:var(--cta);font-weight:800;cursor:pointer}
    button:hover{background:var(--cta-hover)}
    button[disabled]{opacity:.65;cursor:not-allowed}
    .resultado{display:none;margin-top:16px;background:#111827;border:1px solid #233045;border-radius:10px;padding:12px}
    .erro{color:#f87171;font-weight:700}
    .sucesso{color:#22c55e;font-weight:700}
    .link{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .link code{color:#ffe082;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;background:#0b1220;border:1px solid var(--border);padding:8px 10px;border-radius:8px}
    .btn-sm{padding:8px 10px;border-radius:8px;border:1px solid #233045;background:#0b1220;color:#fff;text-decoration:none}
    .muted{color:#9fb4ca;font-size:12px;margin-top:4px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Gerador de MiniSite</h1>
    <p class="lead">Preencha os campos e gere automaticamente uma landing page com WhatsApp e, se habilitado, uma proposta em DOCX.</p>

    <label for="servico">Título do serviço</label>
    <input id="servico" placeholder="Ex.: Designer Gráfico" />

    <label for="descricaoCurta">Descrição curta (máx. 160 caracteres)</label>
    <textarea id="descricaoCurta" maxlength="160" placeholder="Ex.: Criação de artes para redes sociais"></textarea>
    <div class="muted"><span id="descCount">0</span>/160</div>

    <label for="whats">WhatsApp com DDD</label>
    <input id="whats" placeholder="(48) 99999-8888" />

    <button id="btn">Criar MiniSite</button>

    <div id="resultado" class="resultado"></div>
  </div>

  <script>
    const ENDPOINT = "/api/gerar"; // ✅ chama a função serverless da Vercel
    const $ = (id) => document.getElementById(id);

    function setLoading(is){
      const b = $("btn");
      b.disabled = is;
      b.textContent = is ? "Gerando..." : "Criar MiniSite";
    }
    function onlyDigits(s){ return String(s||"").replace(/\D+/g,""); }
    $("descricaoCurta").addEventListener("input", e => document.querySelector("#descCount").textContent = e.target.value.length);
    $("whats").addEventListener("input", e => {
      const d = onlyDigits(e.target.value).slice(0,11);
      if (d.length <= 2) e.target.value = d;
      else if (d.length <= 6) e.target.value = `(${d.slice(0,2)}) ${d.slice(2)}`;
      else if (d.length <= 10) e.target.value = `(${d.slice(0,2)}) ${d.slice(2,6)}-${d.slice(6)}`;
      else e.target.value = `(${d.slice(0,2)}) ${d.slice(2,7)}-${d.slice(7)}`;
    });

    $("btn").addEventListener("click", async () => {
      const servico = $("servico").value.trim();
      const descricaoCurta = $("descricaoCurta").value.trim();
      const whats = onlyDigits($("whats").value);

      const r = $("resultado");
      r.style.display = "block";
      r.className = "resultado";
      if (!servico || !descricaoCurta || !whats) {
        r.innerHTML = `<div class="erro">❌ Preencha todos os campos.</div>`;
        return;
      }

      setLoading(true);
      r.textContent = "Gerando MiniSite...";

      try {
        const resp = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ servico, descricaoCurta, whats })
        });

        let data = {};
        try { data = await resp.json(); } catch {}
        if (!resp.ok || !data.ok) {
          const msg = data?.error || data?.mensagem || `Falha (HTTP ${resp.status})`;
          r.innerHTML = `<div class="erro">❌ ${msg}</div>`;
          return;
        }

        const previewUrl = data?.urlFinal || data?.outputs?.previewUrl || data?.url || "";
        const docxUrl    = data?.outputs?.docxUrl || "";

        let html = `<div class="sucesso">✅ MiniSite gerado!</div>`;
        if (previewUrl) {
          html += `
            <div class="link">
              <span>MiniSite:</span>
              <code title="${previewUrl}">${previewUrl}</code>
              <a class="btn-sm" href="${previewUrl}" target="_blank" rel="noopener">Abrir</a>
              <button class="btn-sm" id="copyMini" type="button">Copiar</button>
            </div>`;
        }
        if (docxUrl) {
          html += `
            <div class="link">
              <span>DOCX:</span>
              <code title="${docxUrl}">${docxUrl}</code>
              <a class="btn-sm" href="${docxUrl}" target="_blank" rel="noopener">Abrir</a>
              <button class="btn-sm" id="copyDocx" type="button">Copiar</button>
            </div>`;
        }
        r.innerHTML = html;

        const copyMini = document.getElementById("copyMini");
        if (copyMini && previewUrl) copyMini.onclick = () => navigator.clipboard.writeText(previewUrl);
        const copyDocx = document.getElementById("copyDocx");
        if (copyDocx && docxUrl) copyDocx.onclick = () => navigator.clipboard.writeText(docxUrl);

      } catch (e) {
        r.innerHTML = `<div class="erro">❌ Erro (JS): ${e?.message || e}</div>`;
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
